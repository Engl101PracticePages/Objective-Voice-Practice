import React, { useMemo, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Badge } from "@/components/ui/badge";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import { CheckCircle2, RefreshCcw, Sparkles } from "lucide-react";

const SectionTitle = ({ children }) => (
  <div className="flex items-center gap-2">
    <Sparkles className="h-4 w-4" />
    <h2 className="text-lg font-semibold">{children}</h2>
  </div>
);

const Pill = ({ children }) => (
  <span className="inline-flex items-center rounded-full border px-3 py-1 text-sm">
    {children}
  </span>
);

function scoreHint(text) {
  const t = (text || "").toLowerCase();
  const flags = [
    { key: "i think", label: 'Try removing “I think”', bad: true },
    { key: "i believe", label: 'Try removing “I believe”', bad: true },
    { key: "for me", label: 'Avoid “for me” in objective voice', bad: true },
    { key: "best", label: '“Best” needs evidence or a more specific claim', bad: true },
    { key: "super", label: 'Avoid casual words like “super”', bad: true },
    { key: "totally", label: 'Avoid casual words like “totally”', bad: true },
    { key: "this essay will", label: 'Good: “This essay will…” is objective framing', good: true },
    { key: "according to", label: 'Good: signals research-based language', good: true },
    { key: "studies", label: 'Good: signals evidence', good: true },
  ];

  const hits = flags.filter((f) => t.includes(f.key));
  const good = hits.filter((h) => h.good).map((h) => h.label);
  const bad = hits.filter((h) => h.bad).map((h) => h.label);

  // A tiny, friendly “meter” (not grading, just guidance)
  let meter = 50;
  meter += good.length * 12;
  meter -= bad.length * 14;
  meter = Math.max(0, Math.min(100, meter));

  return { meter, good, bad };
}

export default function ObjectiveVoiceInteractiveCanvas() {
  const [mode, setMode] = useState("learn"); // learn | practice
  const [custom, setCustom] = useState(
    "I think veterinary school is super hard, but it’s totally worth it because it’s the best way to work with animals."
  );

  const hint = useMemo(() => scoreHint(custom), [custom]);

  const examples = useMemo(
    () => [
      {
        subjective:
          "I think getting a DVM is the best choice for a veterinary career.",
        objective:
          "Studies indicate that obtaining a DVM leads to increased career opportunities in veterinary medicine.",
      },
      {
        subjective:
          "I will compare different veterinary programs to decide which one is best for me.",
        objective:
          "This essay will compare different veterinary programs to analyze their advantages and requirements.",
      },
    ],
    []
  );

  const practicePrompts = useMemo(
    () => [
      {
        id: "p1",
        prompt:
          "I believe that becoming a veterinarian is a great career choice because I love animals.",
        starter:
          "Veterinary medicine provides…",
      },
      {
        id: "p2",
        prompt:
          "I think veterinarians are in high demand because more people have pets now.",
        starter:
          "According to…",
      },
      {
        id: "p3",
        prompt:
          "Veterinary school is super hard, but it’s totally worth it because it’s the best way to work with animals.",
        starter:
          "Veterinary school requires…",
      },
    ],
    []
  );

  const [activePrompt, setActivePrompt] = useState(practicePrompts[0]);
  const [studentRewrite, setStudentRewrite] = useState("");
  const [showCoach, setShowCoach] = useState(false);

  const rewriteHint = useMemo(() => scoreHint(studentRewrite), [studentRewrite]);

  const checklist = [
    "Does the sentence rely on facts (not personal opinion)?",
    "Could someone else fact-check it?",
    "Does it use research-based language instead of personal belief?",
  ];

  return (
    <div className="min-h-screen w-full bg-gradient-to-b from-white to-neutral-50 p-6">
      <div className="mx-auto max-w-4xl space-y-6">
        <header className="flex flex-col gap-3">
          <h1 className="text-3xl font-bold tracking-tight">Objective Voice</h1>
          <p className="text-base text-neutral-700">
            A quick, student-friendly page for learning and practicing objective
            voice (no “I think,” more facts + evidence).
          </p>
          <div className="flex flex-wrap gap-2">
            <Button
              variant={mode === "learn" ? "default" : "outline"}
              onClick={() => setMode("learn")}
            >
              Learn
            </Button>
            <Button
              variant={mode === "practice" ? "default" : "outline"}
              onClick={() => setMode("practice")}
            >
              Practice
            </Button>
          </div>
        </header>

        {mode === "learn" && (
          <div className="space-y-6">
            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>What is objective voice?</SectionTitle>
                <div className="flex flex-wrap gap-2">
                  <Pill>Avoids personal opinions (e.g., “I think,” “I believe”)</Pill>
                  <Pill>Focuses on facts, evidence, and research</Pill>
                  <Pill>Uses formal language</Pill>
                </div>
              </CardContent>
            </Card>

            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>Objective vs. subjective examples</SectionTitle>
                <div className="grid gap-4">
                  {examples.map((ex, idx) => (
                    <div
                      key={idx}
                      className="rounded-2xl border bg-white p-4"
                    >
                      <div className="flex flex-wrap items-center gap-2 mb-2">
                        <Badge variant="secondary">Subjective</Badge>
                        <span className="text-neutral-800">{ex.subjective}</span>
                      </div>
                      <div className="flex flex-wrap items-center gap-2">
                        <Badge>Objective</Badge>
                        <span className="text-neutral-800">{ex.objective}</span>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>Strategies for writing objectively</SectionTitle>

                <Accordion type="single" collapsible className="w-full">
                  <AccordionItem value="s1">
                    <AccordionTrigger>
                      Use third-person instead of first-person pronouns
                    </AccordionTrigger>
                    <AccordionContent>
                      <div className="space-y-3">
                        <div className="rounded-xl border p-3 bg-neutral-50">
                          <div className="text-sm font-semibold">First-person</div>
                          <div className="text-sm text-neutral-800">
                            “I believe that becoming a veterinarian is a great
                            career choice because I love animals.”
                          </div>
                        </div>
                        <div className="rounded-xl border p-3 bg-white">
                          <div className="text-sm font-semibold">Objective version</div>
                          <div className="text-sm text-neutral-800">
                            “Veterinary medicine provides a rewarding career for
                            those interested in animal healthcare, as it combines
                            medical expertise with compassionate treatment.”
                          </div>
                        </div>
                        <div className="text-sm text-neutral-700">
                          Tip: Instead of “I will discuss,” try “This essay will
                          examine.”
                        </div>
                      </div>
                    </AccordionContent>
                  </AccordionItem>

                  <AccordionItem value="s2">
                    <AccordionTrigger>
                      Replace opinions with researched, evidence-based statements
                    </AccordionTrigger>
                    <AccordionContent>
                      <div className="space-y-3">
                        <div className="rounded-xl border p-3 bg-neutral-50">
                          <div className="text-sm font-semibold">Opinion-based</div>
                          <div className="text-sm text-neutral-800">
                            “I think veterinarians are in high demand because more
                            people have pets now.”
                          </div>
                        </div>
                        <div className="rounded-xl border p-3 bg-white">
                          <div className="text-sm font-semibold">Evidence-based</div>
                          <div className="text-sm text-neutral-800">
                            “According to the Bureau of Labor Statistics, the
                            demand for veterinarians is expected to grow by 19%
                            by 2031, due to increased pet ownership and
                            advancements in animal healthcare.”
                          </div>
                        </div>
                        <div className="text-sm text-neutral-700">
                          Why it matters: objective writing relies on data instead
                          of personal opinions.
                        </div>
                      </div>
                    </AccordionContent>
                  </AccordionItem>

                  <AccordionItem value="s3">
                    <AccordionTrigger>Use neutral, academic language</AccordionTrigger>
                    <AccordionContent>
                      <div className="space-y-3">
                        <div className="rounded-xl border p-3 bg-neutral-50">
                          <div className="text-sm font-semibold">Casual</div>
                          <div className="text-sm text-neutral-800">
                            “Veterinary school is super hard, but it’s totally
                            worth it because it’s the best way to work with
                            animals.”
                          </div>
                        </div>
                        <div className="rounded-xl border p-3 bg-white">
                          <div className="text-sm font-semibold">Academic</div>
                          <div className="text-sm text-neutral-800">
                            “Veterinary school requires rigorous training, but it
                            provides essential skills needed for a successful
                            career in animal healthcare.”
                          </div>
                        </div>
                        <ul className="list-disc pl-5 text-sm text-neutral-700 space-y-1">
                          <li>
                            Avoid casual phrases like “super hard” or “totally
                            worth it.”
                          </li>
                          <li>
                            Replace “best” with specific reasoning (what evidence
                            supports it?).
                          </li>
                          <li>
                            Formal writing uses precise, professional vocabulary.
                          </li>
                        </ul>
                      </div>
                    </AccordionContent>
                  </AccordionItem>
                </Accordion>
              </CardContent>
            </Card>

            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>Quick self-check</SectionTitle>
                <p className="text-neutral-700">
                  Whenever you write a sentence, ask:
                </p>
                <div className="grid gap-2">
                  {checklist.map((c, i) => (
                    <div key={i} className="flex items-start gap-2">
                      <CheckCircle2 className="h-5 w-5 mt-0.5" />
                      <span className="text-neutral-800">{c}</span>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>Try it: quick “objective voice” coach</SectionTitle>
                <p className="text-sm text-neutral-700">
                  Paste one sentence below. This doesn’t grade you—it just gives
                  simple hints.
                </p>
                <Textarea
                  value={custom}
                  onChange={(e) => setCustom(e.target.value)}
                  className="min-h-[90px]"
                />
                <div className="rounded-2xl border bg-white p-4">
                  <div className="flex items-center justify-between gap-4">
                    <div className="text-sm font-semibold">Objective meter</div>
                    <div className="text-sm text-neutral-700">{hint.meter}/100</div>
                  </div>
                  <div className="mt-3 h-2 w-full rounded-full bg-neutral-100">
                    <div
                      className="h-2 rounded-full bg-neutral-900"
                      style={{ width: `${hint.meter}%` }}
                    />
                  </div>
                  <div className="mt-4 grid gap-2">
                    {hint.bad.length > 0 && (
                      <div className="text-sm">
                        <div className="font-semibold">Things to revise</div>
                        <ul className="list-disc pl-5 text-neutral-700">
                          {hint.bad.map((b, i) => (
                            <li key={i}>{b}</li>
                          ))}
                        </ul>
                      </div>
                    )}
                    {hint.good.length > 0 && (
                      <div className="text-sm">
                        <div className="font-semibold">Good moves</div>
                        <ul className="list-disc pl-5 text-neutral-700">
                          {hint.good.map((g, i) => (
                            <li key={i}>{g}</li>
                          ))}
                        </ul>
                      </div>
                    )}
                    {hint.good.length === 0 && hint.bad.length === 0 && (
                      <div className="text-sm text-neutral-700">
                        Keep going—try adding research-based language like
                        “According to…”
                      </div>
                    )}
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        )}

        {mode === "practice" && (
          <div className="space-y-6">
            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-4">
                <SectionTitle>Practice removing subjectivity</SectionTitle>
                <p className="text-neutral-700">
                  Pick a prompt, rewrite it objectively, then check your work.
                </p>

                <div className="flex flex-wrap gap-2">
                  {practicePrompts.map((p) => (
                    <Button
                      key={p.id}
                      variant={activePrompt.id === p.id ? "default" : "outline"}
                      onClick={() => {
                        setActivePrompt(p);
                        setStudentRewrite("");
                        setShowCoach(false);
                      }}
                    >
                      Prompt {p.id.toUpperCase()}
                    </Button>
                  ))}
                </div>

                <div className="rounded-2xl border bg-white p-4 space-y-2">
                  <div className="text-sm font-semibold">Original (subjective)</div>
                  <div className="text-neutral-800">{activePrompt.prompt}</div>
                  <div className="text-sm text-neutral-600">
                    Starter idea: <span className="font-medium">{activePrompt.starter}</span>
                  </div>
                </div>

                <div className="space-y-2">
                  <div className="text-sm font-semibold">Your rewrite (objective)</div>
                  <Textarea
                    value={studentRewrite}
                    onChange={(e) => setStudentRewrite(e.target.value)}
                    className="min-h-[110px]"
                    placeholder="Rewrite the sentence in objective voice…"
                  />
                </div>

                <div className="flex flex-wrap gap-2">
                  <Button onClick={() => setShowCoach(true)}>
                    Check my sentence
                  </Button>
                  <Button
                    variant="outline"
                    onClick={() => {
                      setStudentRewrite("");
                      setShowCoach(false);
                    }}
                  >
                    <RefreshCcw className="h-4 w-4 mr-2" />
                    Reset
                  </Button>
                </div>

                {showCoach && (
                  <div className="rounded-2xl border bg-white p-4">
                    <div className="flex items-center justify-between gap-4">
                      <div className="text-sm font-semibold">Coach</div>
                      <div className="text-sm text-neutral-700">
                        {rewriteHint.meter}/100
                      </div>
                    </div>
                    <div className="mt-3 grid gap-2">
                      {rewriteHint.bad.length > 0 ? (
                        <>
                          <div className="text-sm font-semibold">Try revising:</div>
                          <ul className="list-disc pl-5 text-sm text-neutral-700">
                            {rewriteHint.bad.map((b, i) => (
                              <li key={i}>{b}</li>
                            ))}
                          </ul>
                        </>
                      ) : (
                        <div className="text-sm text-neutral-700">
                          Nice—this is pretty objective.
                        </div>
                      )}

                      <div className="mt-2 text-sm">
                        <div className="font-semibold">Self-check questions</div>
                        <ul className="list-disc pl-5 text-neutral-700">
                          {checklist.map((c, i) => (
                            <li key={i}>{c}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>

            <Card className="rounded-2xl shadow-sm">
              <CardContent className="p-6 space-y-3">
                <SectionTitle>Mini challenge</SectionTitle>
                <p className="text-neutral-700">
                  Write one sentence that starts with <span className="font-semibold">“This essay will…”</span>
                  and stays objective.
                </p>
                <Input placeholder="This essay will…" />
                <p className="text-sm text-neutral-600">
                  Tip: Avoid “best,” “I think,” and casual words. Try “by
                  examining…” or “according to…”
                </p>
              </CardContent>
            </Card>
          </div>
        )}

        <footer className="pt-2 text-xs text-neutral-500">
          Built for class practice: objective voice, neutral language, and
          evidence-based statements.
        </footer>
      </div>
    </div>
  );
}
